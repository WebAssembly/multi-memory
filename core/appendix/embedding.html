
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Embedding &#8212; WebAssembly 1.0</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Implementation Limitations" href="implementation.html" />
    <link rel="prev" title="Appendix" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head> <script type="text/javascript">MathJax.Hub.Config({TeX: {MAXBUFFER: 30*1024}})</script><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/webassembly.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../syntax/index.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../valid/index.html">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../exec/index.html">Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binary/index.html">Binary Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../text/index.html">Text Format</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Appendix</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Embedding</a></li>
<li class="toctree-l2"><a class="reference internal" href="implementation.html">Implementation Limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="algorithm.html">Validation Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom.html">Custom Sections</a></li>
<li class="toctree-l2"><a class="reference internal" href="properties.html">Soundness</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index-types.html">Index of Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="index-instructions.html">Index of Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="index-rules.html">Index of Semantic Rules</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="../genindex.html">Index</a></li>
    
    <li class="toctree-l1"><a href="../_download/WebAssembly.pdf">Download as PDF</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="embedding">
<span id="embed"></span><span id="index-0"></span><h1>Embedding<a class="headerlink" href="#embedding" title="Permalink to this headline">¶</a></h1>
<p>A WebAssembly implementation will typically be <em>embedded</em> into a <em>host</em> environment.
An <em>embedder</em> implements the connection between such a host environment and the WebAssembly semantics as defined in the main body of this specification.
An embedder is expected to interact with the semantics in well-defined ways.</p>
<p>This section defines a suitable interface to the WebAssembly semantics in the form of entry points through which an embedder can access it.
The interface is intended to be complete, in the sense that an embedder does not need to reference other functional parts of the WebAssembly specification directly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On the other hand, an embedder does not need to provide the host environment with access to all functionality defined in this interface.
For example, an implementation may not support <a class="reference internal" href="#embed-module-parse"><span class="std std-ref">parsing</span></a> of the <a class="reference internal" href="../text/index.html#text"><span class="std std-ref">text format</span></a>.</p>
</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<p>In the description of the embedder interface, syntactic classes from the <a class="reference internal" href="../syntax/index.html#syntax"><span class="std std-ref">abstract syntax</span></a> and the <a class="reference internal" href="../exec/runtime.html#syntax-runtime"><span class="std std-ref">runtime’s abstract machine</span></a> are used as names for variables that range over the possible objects from that class.
Hence, these syntactic classes can also be interpreted as types.</p>
<p>For numeric parameters, notation like <span class="math notranslate nohighlight">\(n:\href{../syntax/values.html#syntax-int}{\mathit{u32}}\)</span> is used to specify a symbolic name in addition to the respective value range.</p>
</div>
<div class="section" id="errors">
<span id="embed-error"></span><h2>Errors<a class="headerlink" href="#errors" title="Permalink to this headline">¶</a></h2>
<p>Failure of an interface operation is indicated by an auxiliary syntactic class:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{llll}
\def\mathdef75#1{{}}\mathdef75{(error)} &amp; \href{../appendix/embedding.html#embed-error}{\mathit{error}} &amp;::=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} \\
\end{array}\end{split}\]</div>
<p>In addition to the error conditions specified explicitly in this section, implementations may also return errors when specific <a class="reference internal" href="implementation.html#impl"><span class="std std-ref">implementation limitations</span></a> are reached.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Errors are abstract and unspecific with this definition.
Implementations can refine it to carry suitable classifications and diagnostic messages.</p>
</div>
</div>
<div class="section" id="pre-and-post-conditions">
<h2>Pre- and Post-Conditions<a class="headerlink" href="#pre-and-post-conditions" title="Permalink to this headline">¶</a></h2>
<p>Some operations state <em>pre-conditions</em> about their arguments or <em>post-conditions</em> about their results.
It is the embedder’s responsibility to meet the pre-conditions.
If it does, the post conditions are guaranteed by the semantics.</p>
<p>In addition to pre- and post-conditions explicitly stated with each operation, the specification adopts the following conventions for <a class="reference internal" href="../exec/runtime.html#syntax-runtime"><span class="std std-ref">runtime objects</span></a> (<span class="math notranslate nohighlight">\(store\)</span>, <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}\)</span>, <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}\)</span>, <a class="reference internal" href="../exec/runtime.html#syntax-addr"><span class="std std-ref">addresses</span></a>):</p>
<ul class="simple">
<li>Every runtime object passed as a parameter must be <a class="reference internal" href="properties.html#valid-store"><span class="std std-ref">valid</span></a> per an implicit pre-condition.</li>
<li>Every runtime object returned as a result is <a class="reference internal" href="properties.html#valid-store"><span class="std std-ref">valid</span></a> per an implicit post-condition.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As long as an embedder treats runtime objects as abstract and only creates and manipulates them through the interface defined here, all implicit pre-conditions are automatically met.</p>
</div>
</div>
<div class="section" id="store">
<span id="embed-store"></span><span id="index-1"></span><h2>Store<a class="headerlink" href="#store" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-store-init">
<span id="id1"></span><h3><span class="math notranslate nohighlight">\(\mathrm{store\_init}() : \href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span><a class="headerlink" href="#embed-store-init" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Return the empty <a class="reference internal" href="../exec/runtime.html#syntax-store"><span class="std std-ref">store</span></a>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{store\_init}() &amp;=&amp; \{ \href{../exec/runtime.html#syntax-store}{\mathsf{funcs}}~\epsilon,~ \href{../exec/runtime.html#syntax-store}{\mathsf{mems}}~\epsilon,~ \href{../exec/runtime.html#syntax-store}{\mathsf{tables}}~\epsilon,~ \href{../exec/runtime.html#syntax-store}{\mathsf{globals}}~\epsilon \} \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="modules">
<span id="embed-module"></span><span id="index-2"></span><h2>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-module-decode">
<span id="index-3"></span><span id="id2"></span><h3><span class="math notranslate nohighlight">\(\mathrm{module\_decode}(\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast) : \href{../syntax/modules.html#syntax-module}{\mathit{module}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-module-decode" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>If there exists a derivation for the <a class="reference internal" href="../syntax/values.html#syntax-byte"><span class="std std-ref">byte</span></a> sequence <span class="math notranslate nohighlight">\(\href{../syntax/values.html#syntax-byte}{\mathit{byte}}^\ast\)</span> as a <span class="math notranslate nohighlight">\(\href{../binary/modules.html#binary-module}{\mathtt{module}}\)</span> according to the <a class="reference internal" href="../binary/modules.html#binary-module"><span class="std std-ref">binary grammar for modules</span></a>, yielding a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a> <span class="math notranslate nohighlight">\(m\)</span>, then return <span class="math notranslate nohighlight">\(m\)</span>.</li>
<li>Else, return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{module\_decode}(b^\ast) &amp;=&amp; m &amp;&amp; (\mathrel{\mbox{if}} \href{../binary/modules.html#binary-module}{\mathtt{module}} \stackrel\ast\Longrightarrow m{:}b^\ast) \\
\mathrm{module\_decode}(b^\ast) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-module-parse">
<span id="index-4"></span><span id="id3"></span><h3><span class="math notranslate nohighlight">\(\mathrm{module\_parse}(\href{../syntax/values.html#syntax-name}{\mathit{char}}^\ast) : \href{../syntax/modules.html#syntax-module}{\mathit{module}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-module-parse" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>If there exists a derivation for the <a class="reference internal" href="../text/lexical.html#text-source"><span class="std std-ref">source</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/values.html#syntax-name}{\mathit{char}}^\ast\)</span> as a <span class="math notranslate nohighlight">\(\href{../text/modules.html#text-module}{\mathtt{module}}\)</span> according to the <a class="reference internal" href="../text/modules.html#text-module"><span class="std std-ref">text grammar for modules</span></a>, yielding a <a class="reference internal" href="../syntax/modules.html#syntax-module"><span class="std std-ref">module</span></a> <span class="math notranslate nohighlight">\(m\)</span>, then return <span class="math notranslate nohighlight">\(m\)</span>.</li>
<li>Else, return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{module\_parse}(c^\ast) &amp;=&amp; m &amp;&amp; (\mathrel{\mbox{if}} \href{../text/modules.html#text-module}{\mathtt{module}} \stackrel\ast\Longrightarrow m{:}c^\ast) \\
\mathrm{module\_parse}(c^\ast) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-module-validate">
<span id="index-5"></span><span id="id4"></span><h3><span class="math notranslate nohighlight">\(\mathrm{module\_validate}(\href{../syntax/modules.html#syntax-module}{\mathit{module}}) : \href{../appendix/embedding.html#embed-error}{\mathit{error}}^?\)</span><a class="headerlink" href="#embed-module-validate" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>If <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-module}{\mathit{module}}\)</span> is <a class="reference internal" href="../valid/modules.html#valid-module"><span class="std std-ref">valid</span></a>, then return nothing.</li>
<li>Else, return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{module\_validate}(m) &amp;=&amp; \epsilon &amp;&amp; (\mathrel{\mbox{if}} {} \href{../valid/modules.html#valid-module}{\vdash} m : \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast \href{../syntax/types.html#syntax-functype}{\rightarrow} {\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast) \\
\mathrm{module\_validate}(m) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-module-instantiate">
<span id="index-6"></span><span id="id5"></span><h3><span class="math notranslate nohighlight">\(\mathrm{module\_instantiate}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../syntax/modules.html#syntax-module}{\mathit{module}}, \href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast) : (\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}})\)</span><a class="headerlink" href="#embed-module-instantiate" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Try <a class="reference internal" href="../exec/modules.html#exec-instantiation"><span class="std std-ref">instantiating</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-module}{\mathit{module}}\)</span> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span> with <a class="reference internal" href="../exec/runtime.html#syntax-externval"><span class="std std-ref">external values</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathit{externval}}^\ast\)</span> as imports:</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>If it succeeds with a <a class="reference internal" href="../exec/runtime.html#syntax-moduleinst"><span class="std std-ref">module instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}\)</span>, then let <span class="math notranslate nohighlight">\(\mathit{result}\)</span> be <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}\)</span>.</li>
<li>Else, let <span class="math notranslate nohighlight">\(\mathit{result}\)</span> be <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Return the new store paired with <span class="math notranslate nohighlight">\(\mathit{result}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{module\_instantiate}(S, m, \mathit{ev}^\ast) &amp;=&amp; (S', F.\href{../exec/runtime.html#syntax-frame}{\mathsf{module}}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#exec-instantiation}{\mathrm{instantiate}}(S, m, \mathit{ev}^\ast) \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^\ast S'; F; \epsilon) \\
\mathrm{module\_instantiate}(S, m, \mathit{ev}^\ast) &amp;=&amp; (S', \href{../appendix/embedding.html#embed-error}{\mathsf{error}}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#exec-instantiation}{\mathrm{instantiate}}(S, m, \mathit{ev}^\ast) \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^\ast S'; F; \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}) \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The store may be modified even in case of an error.</p>
</div>
</div>
<div class="section" id="embed-module-imports">
<span id="index-7"></span><span id="id6"></span><h3><span class="math notranslate nohighlight">\(\mathrm{module\_imports}(\href{../syntax/modules.html#syntax-module}{\mathit{module}}) : (\href{../syntax/values.html#syntax-name}{\mathit{name}}, \href{../syntax/values.html#syntax-name}{\mathit{name}}, \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}})^\ast\)</span><a class="headerlink" href="#embed-module-imports" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Pre-condition: <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-module}{\mathit{module}}\)</span> is <a class="reference internal" href="../valid/modules.html#valid-module"><span class="std std-ref">valid</span></a> with external import types <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast\)</span> and external export types <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast\)</span>.</li>
<li>Let <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-import}{\mathit{import}}^\ast\)</span> be the <a class="reference internal" href="../syntax/modules.html#syntax-import"><span class="std std-ref">imports</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-module}{\mathit{module}}.\href{../syntax/modules.html#syntax-module}{\mathsf{imports}}\)</span>.</li>
<li>Assert: the length of <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-import}{\mathit{import}}^\ast\)</span> equals the length of <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast\)</span>.</li>
<li>For each <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-import}{\mathit{import}}_i\)</span> in <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-import}{\mathit{import}}^\ast\)</span> and corresponding <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}_i\)</span> in <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast\)</span>, do:</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{result}_i\)</span> be the triple <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-import}{\mathit{import}}_i.\href{../syntax/modules.html#syntax-import}{\mathsf{module}}, \href{../syntax/modules.html#syntax-import}{\mathit{import}}_i.\href{../syntax/modules.html#syntax-import}{\mathsf{name}}, \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}_i)\)</span>.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Return the concatenation of all <span class="math notranslate nohighlight">\(\mathit{result}_i\)</span>, in index order.</li>
<li>Post-condition: each <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}_i\)</span> is <a class="reference internal" href="../valid/types.html#valid-externtype"><span class="std std-ref">valid</span></a>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{module\_imports}(m) &amp;=&amp; (\mathit{im}.\href{../syntax/modules.html#syntax-import}{\mathsf{module}}, \mathit{im}.\href{../syntax/modules.html#syntax-import}{\mathsf{name}}, \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}})^\ast \\
  &amp;&amp; \qquad (\mathrel{\mbox{if}} \mathit{im}^\ast = m.\href{../syntax/modules.html#syntax-module}{\mathsf{imports}} \wedge {} \href{../valid/modules.html#valid-module}{\vdash} m : \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast \href{../syntax/types.html#syntax-functype}{\rightarrow} {\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-module-exports">
<span id="index-8"></span><span id="id7"></span><h3><span class="math notranslate nohighlight">\(\mathrm{module\_exports}(\href{../syntax/modules.html#syntax-module}{\mathit{module}}) : (\href{../syntax/values.html#syntax-name}{\mathit{name}}, \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}})^\ast\)</span><a class="headerlink" href="#embed-module-exports" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Pre-condition: <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-module}{\mathit{module}}\)</span> is <a class="reference internal" href="../valid/modules.html#valid-module"><span class="std std-ref">valid</span></a> with external import types <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast\)</span> and external export types <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast\)</span>.</li>
<li>Let <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-export}{\mathit{export}}^\ast\)</span> be the <a class="reference internal" href="../syntax/modules.html#syntax-export"><span class="std std-ref">exports</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-module}{\mathit{module}}.\href{../syntax/modules.html#syntax-module}{\mathsf{exports}}\)</span>.</li>
<li>Assert: the length of <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-export}{\mathit{export}}^\ast\)</span> equals the length of <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast\)</span>.</li>
<li>For each <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-export}{\mathit{export}}_i\)</span> in <span class="math notranslate nohighlight">\(\href{../syntax/modules.html#syntax-export}{\mathit{export}}^\ast\)</span> and corresponding <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'_i\)</span> in <span class="math notranslate nohighlight">\({\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast\)</span>, do:</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{result}_i\)</span> be the pair <span class="math notranslate nohighlight">\((\href{../syntax/modules.html#syntax-export}{\mathit{export}}_i.\href{../syntax/modules.html#syntax-export}{\mathsf{name}}, \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'_i)\)</span>.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="5">
<li>Return the concatenation of all <span class="math notranslate nohighlight">\(\mathit{result}_i\)</span>, in index order.</li>
<li>Post-condition: each <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'_i\)</span> is <a class="reference internal" href="../valid/types.html#valid-externtype"><span class="std std-ref">valid</span></a>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{module\_exports}(m) &amp;=&amp; (\mathit{ex}.\href{../syntax/modules.html#syntax-export}{\mathsf{name}}, \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}')^\ast \\
  &amp;&amp; \qquad (\mathrel{\mbox{if}} \mathit{ex}^\ast = m.\href{../syntax/modules.html#syntax-module}{\mathsf{exports}} \wedge {} \href{../valid/modules.html#valid-module}{\vdash} m : \href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}^\ast \href{../syntax/types.html#syntax-functype}{\rightarrow} {\href{../syntax/types.html#syntax-externtype}{\mathit{externtype}}'}^\ast) \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="module-instances">
<span id="embed-instance"></span><span id="index-9"></span><h2>Module Instances<a class="headerlink" href="#module-instances" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-instance-export">
<span id="index-10"></span><span id="id8"></span><h3><span class="math notranslate nohighlight">\(\mathrm{instance\_export}(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}, \href{../syntax/values.html#syntax-name}{\mathit{name}}) : \href{../exec/runtime.html#syntax-externval}{\mathit{externval}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-instance-export" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Assert: due to <a class="reference internal" href="properties.html#valid-moduleinst"><span class="std std-ref">validity</span></a> of the <a class="reference internal" href="../exec/runtime.html#syntax-moduleinst"><span class="std std-ref">module instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}\)</span>, all its <a class="reference internal" href="../exec/runtime.html#syntax-exportinst"><span class="std std-ref">export names</span></a> are different.</li>
<li>If there exists an <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}}_i\)</span> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-moduleinst}{\mathit{moduleinst}}.\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{exports}}\)</span> such that <a class="reference internal" href="../syntax/values.html#syntax-name"><span class="std std-ref">name</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}}_i.\href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}}\)</span> equals <span class="math notranslate nohighlight">\(\href{../syntax/values.html#syntax-name}{\mathit{name}}\)</span>, then:<ol class="loweralpha">
<li>Return the <a class="reference internal" href="../exec/runtime.html#syntax-externval"><span class="std std-ref">external value</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-exportinst}{\mathit{exportinst}}_i.\href{../exec/runtime.html#syntax-exportinst}{\mathsf{value}}\)</span>.</li>
</ol>
</li>
<li>Else, return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{instance\_export}(m, \href{../syntax/values.html#syntax-name}{\mathit{name}}) &amp;=&amp; m.\href{../exec/runtime.html#syntax-moduleinst}{\mathsf{exports}}[i].\href{../exec/runtime.html#syntax-exportinst}{\mathsf{value}} &amp;&amp; (\mathrel{\mbox{if}} m.\href{../syntax/modules.html#syntax-module}{\mathsf{exports}}[i].\href{../exec/runtime.html#syntax-exportinst}{\mathsf{name}} = \href{../syntax/values.html#syntax-name}{\mathit{name}}) \\
\mathrm{instance\_export}(m, \href{../syntax/values.html#syntax-name}{\mathit{name}}) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="functions">
<span id="embed-func"></span><span id="index-11"></span><h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-func-alloc">
<span id="id9"></span><h3><span class="math notranslate nohighlight">\(\mathrm{func\_alloc}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../syntax/types.html#syntax-functype}{\mathit{functype}}, \href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}}) : (\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}})\)</span><a class="headerlink" href="#embed-func-alloc" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Pre-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-functype&gt;\)</span>.</li>
<li>Let <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}\)</span> be the result of <a class="reference internal" href="../exec/modules.html#alloc-func"><span class="std std-ref">allocating a host function</span></a> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span> with <a class="reference internal" href="../syntax/types.html#syntax-functype"><span class="std std-ref">function type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span> and host function code <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}}\)</span>.</li>
<li>Return the new store paired with <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{func\_alloc}(S, \mathit{ft}, \mathit{code}) &amp;=&amp; (S', \mathit{a}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#alloc-hostfunc}{\mathrm{allochostfunc}}(S, \mathit{ft}, \mathit{code}) = S', \mathit{a}) \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This operation assumes that <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-hostfunc}{\mathit{hostfunc}}\)</span> satisfies the <a class="reference internal" href="../exec/instructions.html#exec-invoke-host"><span class="std std-ref">pre- and post-conditions</span></a> required for a function instance with type <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span>.</p>
<p class="last">Regular (non-host) function instances can only be created indirectly through <a class="reference internal" href="#embed-module-instantiate"><span class="std std-ref">module instantiation</span></a>.</p>
</div>
</div>
<div class="section" id="embed-func-type">
<span id="id10"></span><h3><span class="math notranslate nohighlight">\(\mathrm{func\_type}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}) : \href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span><a class="headerlink" href="#embed-func-type" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Assert: the <a class="reference internal" href="../exec/runtime.html#syntax-externval"><span class="std std-ref">external value</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathsf{func}}~\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}\)</span> is <a class="reference internal" href="../exec/modules.html#valid-externval"><span class="std std-ref">valid</span></a> with <a class="reference internal" href="../syntax/types.html#syntax-externtype"><span class="std std-ref">external type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathsf{func}}~\href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span>.</li>
<li>Return <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span>.</li>
<li>Post-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-functype}{\mathit{functype}}\)</span> is <a class="reference internal" href="../valid/types.html#valid-functype"><span class="std std-ref">valid</span></a>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{func\_type}(S, a) &amp;=&amp; \mathit{ft} &amp;&amp; (\mathrel{\mbox{if}} S \href{../exec/modules.html#valid-externval}{\vdash} \href{../exec/runtime.html#syntax-externval}{\mathsf{func}}~a : \href{../syntax/types.html#syntax-externtype}{\mathsf{func}}~\mathit{ft}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-func-invoke">
<span id="index-12"></span><span id="id11"></span><h3><span class="math notranslate nohighlight">\(\mathrm{func\_invoke}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}, \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast) : (\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}})\)</span><a class="headerlink" href="#embed-func-invoke" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Try <a class="reference internal" href="../exec/modules.html#exec-invocation"><span class="std std-ref">invoking</span></a> the function <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}\)</span> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span> with <a class="reference internal" href="../exec/runtime.html#syntax-val"><span class="std std-ref">values</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}^\ast\)</span> as arguments:</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>If it succeeds with <a class="reference internal" href="../exec/runtime.html#syntax-val"><span class="std std-ref">values</span></a> <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^\ast\)</span> as results, then let <span class="math notranslate nohighlight">\(\mathit{result}\)</span> be <span class="math notranslate nohighlight">\({\href{../exec/runtime.html#syntax-val}{\mathit{val}}'}^\ast\)</span>.</li>
<li>Else it has trapped, hence let <span class="math notranslate nohighlight">\(\mathit{result}\)</span> be <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Return the new store paired with <span class="math notranslate nohighlight">\(\mathit{result}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{func\_invoke}(S, a, v^\ast) &amp;=&amp; (S', {v'}^\ast) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#exec-invocation}{\mathrm{invoke}}(S, a, v^\ast) \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^\ast S'; F; {v'}^\ast) \\
\mathrm{func\_invoke}(S, a, v^\ast) &amp;=&amp; (S', \href{../appendix/embedding.html#embed-error}{\mathsf{error}}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#exec-invocation}{\mathrm{invoke}}(S, a, v^\ast) \href{../exec/conventions.html#formal-notation}{\hookrightarrow}^\ast S'; F; \href{../exec/runtime.html#syntax-trap}{\mathsf{trap}}) \\
\end{array}\end{split}\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The store may be modified even in case of an error.</p>
</div>
</div>
</div>
<div class="section" id="tables">
<span id="embed-table"></span><span id="index-13"></span><h2>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-table-alloc">
<span id="id12"></span><h3><span class="math notranslate nohighlight">\(\mathrm{table\_alloc}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}) : (\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}})\)</span><a class="headerlink" href="#embed-table-alloc" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Pre-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-tabletype&gt;\)</span>.</li>
<li>Let <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}\)</span> be the result of <a class="reference internal" href="../exec/modules.html#alloc-table"><span class="std std-ref">allocating a table</span></a> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span> with <a class="reference internal" href="../syntax/types.html#syntax-tabletype"><span class="std std-ref">table type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}\)</span>.</li>
<li>Return the new store paired with <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{table\_alloc}(S, \mathit{tt}) &amp;=&amp; (S', \mathit{a}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#alloc-table}{\mathrm{alloctable}}(S, \mathit{tt}) = S', \mathit{a}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-table-type">
<span id="id13"></span><h3><span class="math notranslate nohighlight">\(\mathrm{table\_type}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}) : \href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}\)</span><a class="headerlink" href="#embed-table-type" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Assert: the <a class="reference internal" href="../exec/runtime.html#syntax-externval"><span class="std std-ref">external value</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathsf{table}}~\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}\)</span> is <a class="reference internal" href="../exec/modules.html#valid-externval"><span class="std std-ref">valid</span></a> with <a class="reference internal" href="../syntax/types.html#syntax-externtype"><span class="std std-ref">external type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathsf{table}}~\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}\)</span>.</li>
<li>Return <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}\)</span>.</li>
<li>Post-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-tabletype}{\mathit{tabletype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-tabletype&gt;\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{table\_type}(S, a) &amp;=&amp; \mathit{tt} &amp;&amp; (\mathrel{\mbox{if}} S \href{../exec/modules.html#valid-externval}{\vdash} \href{../exec/runtime.html#syntax-externval}{\mathsf{table}}~a : \href{../syntax/types.html#syntax-externtype}{\mathsf{table}}~\mathit{tt}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-table-read">
<span id="id14"></span><h3><span class="math notranslate nohighlight">\(\mathrm{table\_read}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}, i:\href{../syntax/values.html#syntax-int}{\mathit{u32}}) : \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}^? ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-table-read" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{ti}\)</span> be the <a class="reference internal" href="../exec/runtime.html#syntax-tableinst"><span class="std std-ref">table instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}]\)</span>.</li>
<li>If <span class="math notranslate nohighlight">\(i\)</span> is larger than or equal to the length of <span class="math notranslate nohighlight">\(\mathit{ti}.\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}\)</span>, then return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
<li>Else, return <span class="math notranslate nohighlight">\(\mathit{ti}.\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}[i]\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{table\_read}(S, a, i) &amp;=&amp; \mathit{fa}^? &amp;&amp; (\mathrel{\mbox{if}} S.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[a].\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}[i] = \mathit{fa}^?) \\
\mathrm{table\_read}(S, a, i) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-table-write">
<span id="id15"></span><h3><span class="math notranslate nohighlight">\(\mathrm{table\_write}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}, i:\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../exec/runtime.html#syntax-funcaddr}{\mathit{funcaddr}}^?) : \href{../exec/runtime.html#syntax-store}{\mathit{store}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-table-write" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{ti}\)</span> be the <a class="reference internal" href="../exec/runtime.html#syntax-tableinst"><span class="std std-ref">table instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}]\)</span>.</li>
<li>If <span class="math notranslate nohighlight">\(i\)</span> is larger than or equal to the length of <span class="math notranslate nohighlight">\(\mathit{ti}.\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}\)</span>, then return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
<li>Replace <span class="math notranslate nohighlight">\(\mathit{ti}.\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}[i]\)</span> with the optional <a class="reference internal" href="../exec/runtime.html#syntax-funcaddr"><span class="std std-ref">function address</span></a> <span class="math notranslate nohighlight">\(\mathit{fa}^?\)</span>.</li>
<li>Return the updated store.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{table\_write}(S, a, i, \mathit{fa}^?) &amp;=&amp; S' &amp;&amp; (\mathrel{\mbox{if}} S' = S \href{../syntax/conventions.html#notation-replace}{\mathrel{\mbox{with}}} \href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[a].\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}[i] = \mathit{fa}^?) \\
\mathrm{table\_write}(S, a, i, \mathit{fa}^?) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-table-size">
<span id="id16"></span><h3><span class="math notranslate nohighlight">\(\mathrm{table\_size}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}) : \href{../syntax/values.html#syntax-int}{\mathit{u32}}\)</span><a class="headerlink" href="#embed-table-size" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Return the length of <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}].\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{table\_size}(S, a) &amp;=&amp; n &amp;&amp;
  (\mathrel{\mbox{if}} |S.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[a].\href{../exec/runtime.html#syntax-tableinst}{\mathsf{elem}}| = n) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-table-grow">
<span id="id17"></span><h3><span class="math notranslate nohighlight">\(\mathrm{table\_grow}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}, n:\href{../syntax/values.html#syntax-int}{\mathit{u32}}) : \href{../exec/runtime.html#syntax-store}{\mathit{store}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-table-grow" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Try <a class="reference internal" href="../exec/modules.html#grow-table"><span class="std std-ref">growing</span></a> the <a class="reference internal" href="../exec/runtime.html#syntax-tableinst"><span class="std std-ref">table instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[\href{../exec/runtime.html#syntax-tableaddr}{\mathit{tableaddr}}]\)</span> by <span class="math notranslate nohighlight">\(n\)</span> elements:<ol class="loweralpha">
<li>If it succeeds, return the updated store.</li>
<li>Else, return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{table\_grow}(S, a, n) &amp;=&amp; S' &amp;&amp;
  (\mathrel{\mbox{if}} S' = S \href{../syntax/conventions.html#notation-replace}{\mathrel{\mbox{with}}} \href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[a] = \href{../exec/modules.html#grow-table}{\mathrm{growtable}}(S.\href{../exec/runtime.html#syntax-store}{\mathsf{tables}}[a], n)) \\
\mathrm{table\_grow}(S, a, n) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="memories">
<span id="embed-mem"></span><span id="index-14"></span><h2>Memories<a class="headerlink" href="#memories" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-mem-alloc">
<span id="id18"></span><h3><span class="math notranslate nohighlight">\(\mathrm{mem\_alloc}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}) : (\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}})\)</span><a class="headerlink" href="#embed-mem-alloc" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Pre-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-memtype&gt;\)</span>.</li>
<li>Let <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}\)</span> be the result of <a class="reference internal" href="../exec/modules.html#alloc-mem"><span class="std std-ref">allocating a memory</span></a> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span> with <a class="reference internal" href="../syntax/types.html#syntax-memtype"><span class="std std-ref">memory type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span>.</li>
<li>Return the new store paired with <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{mem\_alloc}(S, \mathit{mt}) &amp;=&amp; (S', \mathit{a}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#alloc-mem}{\mathrm{allocmem}}(S, \mathit{mt}) = S', \mathit{a}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-mem-type">
<span id="id19"></span><h3><span class="math notranslate nohighlight">\(\mathrm{mem\_type}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}) : \href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span><a class="headerlink" href="#embed-mem-type" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Assert: the <a class="reference internal" href="../exec/runtime.html#syntax-externval"><span class="std std-ref">external value</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathsf{mem}}~\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}\)</span> is <a class="reference internal" href="../exec/modules.html#valid-externval"><span class="std std-ref">valid</span></a> with <a class="reference internal" href="../syntax/types.html#syntax-externtype"><span class="std std-ref">external type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathsf{mem}}~\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span>.</li>
<li>Return <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span>.</li>
<li>Post-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-memtype}{\mathit{memtype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-memtype&gt;\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{mem\_type}(S, a) &amp;=&amp; \mathit{mt} &amp;&amp; (\mathrel{\mbox{if}} S \href{../exec/modules.html#valid-externval}{\vdash} \href{../exec/runtime.html#syntax-externval}{\mathsf{mem}}~a : \href{../syntax/types.html#syntax-externtype}{\mathsf{mem}}~\mathit{mt}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-mem-read">
<span id="id20"></span><h3><span class="math notranslate nohighlight">\(\mathrm{mem\_read}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}, i:\href{../syntax/values.html#syntax-int}{\mathit{u32}}) : \href{../syntax/values.html#syntax-byte}{\mathit{byte}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-mem-read" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{mi}\)</span> be the <a class="reference internal" href="../exec/runtime.html#syntax-meminst"><span class="std std-ref">memory instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}]\)</span>.</li>
<li>If <span class="math notranslate nohighlight">\(i\)</span> is larger than or equal to the length of <span class="math notranslate nohighlight">\(\mathit{mi}.\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}\)</span>, then return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
<li>Else, return the  <a class="reference internal" href="../syntax/values.html#syntax-byte"><span class="std std-ref">byte</span></a> <span class="math notranslate nohighlight">\(\mathit{mi}.\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}[i]\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{mem\_read}(S, a, i) &amp;=&amp; b &amp;&amp; (\mathrel{\mbox{if}} S.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[a].\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}[i] = b) \\
\mathrm{mem\_read}(S, a, i) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-mem-write">
<span id="id21"></span><h3><span class="math notranslate nohighlight">\(\mathrm{mem\_write}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}, i:\href{../syntax/values.html#syntax-int}{\mathit{u32}}, \href{../syntax/values.html#syntax-byte}{\mathit{byte}}) : \href{../exec/runtime.html#syntax-store}{\mathit{store}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-mem-write" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{mi}\)</span> be the <a class="reference internal" href="../exec/runtime.html#syntax-meminst"><span class="std std-ref">memory instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}]\)</span>.</li>
<li>If <span class="math notranslate nohighlight">\(\href{../syntax/values.html#syntax-int}{\mathit{u32}}\)</span> is larger than or equal to the length of <span class="math notranslate nohighlight">\(\mathit{mi}.\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}\)</span>, then return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
<li>Replace <span class="math notranslate nohighlight">\(\mathit{mi}.\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}[i]\)</span> with <span class="math notranslate nohighlight">\(\href{../syntax/values.html#syntax-byte}{\mathit{byte}}\)</span>.</li>
<li>Return the updated store.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{mem\_write}(S, a, i, b) &amp;=&amp; S' &amp;&amp; (\mathrel{\mbox{if}} S' = S \href{../syntax/conventions.html#notation-replace}{\mathrel{\mbox{with}}} \href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[a].\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}[i] = b) \\
\mathrm{mem\_write}(S, a, i, b) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-mem-size">
<span id="id22"></span><h3><span class="math notranslate nohighlight">\(\mathrm{mem\_size}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}) : \href{../syntax/values.html#syntax-int}{\mathit{u32}}\)</span><a class="headerlink" href="#embed-mem-size" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Return the length of <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}].\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}\)</span> divided by the <a class="reference internal" href="../exec/runtime.html#page-size"><span class="std std-ref">page size</span></a>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{mem\_size}(S, a) &amp;=&amp; n &amp;&amp;
  (\mathrel{\mbox{if}} |S.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[a].\href{../exec/runtime.html#syntax-meminst}{\mathsf{data}}| = n \cdot 64\,\mathrm{Ki}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-mem-grow">
<span id="id23"></span><h3><span class="math notranslate nohighlight">\(\mathrm{mem\_grow}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}, n:\href{../syntax/values.html#syntax-int}{\mathit{u32}}) : \href{../exec/runtime.html#syntax-store}{\mathit{store}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-mem-grow" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Try <a class="reference internal" href="../exec/modules.html#grow-mem"><span class="std std-ref">growing</span></a> the <a class="reference internal" href="../exec/runtime.html#syntax-meminst"><span class="std std-ref">memory instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[\href{../exec/runtime.html#syntax-memaddr}{\mathit{memaddr}}]\)</span> by <span class="math notranslate nohighlight">\(n\)</span> <a class="reference internal" href="../exec/runtime.html#page-size"><span class="std std-ref">pages</span></a>:<ol class="loweralpha">
<li>If it succeeds, return the updated store.</li>
<li>Else, return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
</ol>
</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{mem\_grow}(S, a, n) &amp;=&amp; S' &amp;&amp;
  (\mathrel{\mbox{if}} S' = S \href{../syntax/conventions.html#notation-replace}{\mathrel{\mbox{with}}} \href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[a] = \href{../exec/modules.html#grow-mem}{\mathrm{growmem}}(S.\href{../exec/runtime.html#syntax-store}{\mathsf{mems}}[a], n)) \\
\mathrm{mem\_grow}(S, a, n) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
</div>
<div class="section" id="globals">
<span id="embed-global"></span><span id="index-15"></span><h2>Globals<a class="headerlink" href="#globals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="embed-global-alloc">
<span id="id24"></span><h3><span class="math notranslate nohighlight">\(\mathrm{global\_alloc}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}, \href{../exec/runtime.html#syntax-val}{\mathit{val}}) : (\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}})\)</span><a class="headerlink" href="#embed-global-alloc" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Pre-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-globaltype&gt;\)</span>.</li>
<li>Let <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}\)</span> be the result of <a class="reference internal" href="../exec/modules.html#alloc-global"><span class="std std-ref">allocating a global</span></a> in <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}\)</span> with <a class="reference internal" href="../syntax/types.html#syntax-globaltype"><span class="std std-ref">global type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}\)</span> and initialization value <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}\)</span>.</li>
<li>Return the new store paired with <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{global\_alloc}(S, \mathit{gt}, v) &amp;=&amp; (S', \mathit{a}) &amp;&amp; (\mathrel{\mbox{if}} \href{../exec/modules.html#alloc-global}{\mathrm{allocglobal}}(S, \mathit{gt}, v) = S', \mathit{a}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-global-type">
<span id="id25"></span><h3><span class="math notranslate nohighlight">\(\mathrm{global\_type}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}) : \href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}\)</span><a class="headerlink" href="#embed-global-type" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Assert: the <a class="reference internal" href="../exec/runtime.html#syntax-externval"><span class="std std-ref">external value</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-externval}{\mathsf{global}}~\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}\)</span> is <a class="reference internal" href="../exec/modules.html#valid-externval"><span class="std std-ref">valid</span></a> with <a class="reference internal" href="../syntax/types.html#syntax-externtype"><span class="std std-ref">external type</span></a> <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-externtype}{\mathsf{global}}~\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}\)</span>.</li>
<li>Return <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}\)</span>.</li>
<li>Post-condition: <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-globaltype}{\mathit{globaltype}}\)</span> is <span class="math notranslate nohighlight">\(valid &lt;valid-globaltype&gt;\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{global\_type}(S, a) &amp;=&amp; \mathit{gt} &amp;&amp; (\mathrel{\mbox{if}} S \href{../exec/modules.html#valid-externval}{\vdash} \href{../exec/runtime.html#syntax-externval}{\mathsf{global}}~a : \href{../syntax/types.html#syntax-externtype}{\mathsf{global}}~\mathit{gt}) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-global-read">
<span id="id26"></span><h3><span class="math notranslate nohighlight">\(\mathrm{global\_read}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}) : \href{../exec/runtime.html#syntax-val}{\mathit{val}}\)</span><a class="headerlink" href="#embed-global-read" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{gi}\)</span> be the <a class="reference internal" href="../exec/runtime.html#syntax-globalinst"><span class="std std-ref">global instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}[\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}]\)</span>.</li>
<li>Return the <a class="reference internal" href="../exec/runtime.html#syntax-val"><span class="std std-ref">value</span></a> <span class="math notranslate nohighlight">\(\mathit{gi}.\href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}}\)</span>.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{lclll}
\mathrm{global\_read}(S, a) &amp;=&amp; v &amp;&amp; (\mathrel{\mbox{if}} S.\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}[a].\href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}} = v) \\
\end{array}\end{split}\]</div>
</div>
<div class="section" id="embed-global-write">
<span id="id27"></span><h3><span class="math notranslate nohighlight">\(\mathrm{global\_write}(\href{../exec/runtime.html#syntax-store}{\mathit{store}}, \href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}, \href{../exec/runtime.html#syntax-val}{\mathit{val}}) : \href{../exec/runtime.html#syntax-store}{\mathit{store}} ~|~ \href{../appendix/embedding.html#embed-error}{\mathit{error}}\)</span><a class="headerlink" href="#embed-global-write" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Let <span class="math notranslate nohighlight">\(\mathit{gi}\)</span> be the <a class="reference internal" href="../exec/runtime.html#syntax-globalinst"><span class="std std-ref">global instance</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-store}{\mathit{store}}.\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}[\href{../exec/runtime.html#syntax-globaladdr}{\mathit{globaladdr}}]\)</span>.</li>
<li>If <span class="math notranslate nohighlight">\(\mathit{gi}.\href{../exec/runtime.html#syntax-globalinst}{\mathsf{mut}}\)</span> is not <span class="math notranslate nohighlight">\(\href{../syntax/types.html#syntax-mut}{\mathsf{var}}\)</span>, then return <span class="math notranslate nohighlight">\(\href{../appendix/embedding.html#embed-error}{\mathsf{error}}\)</span>.</li>
<li>Replace <span class="math notranslate nohighlight">\(\mathit{gi}.\href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}}\)</span> with the <a class="reference internal" href="../exec/runtime.html#syntax-val"><span class="std std-ref">value</span></a> <span class="math notranslate nohighlight">\(\href{../exec/runtime.html#syntax-val}{\mathit{val}}\)</span>.</li>
<li>Return the updated store.</li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}~ \\
\begin{array}{lclll}
\mathrm{global\_write}(S, a, v) &amp;=&amp; S' &amp;&amp; (\mathrel{\mbox{if}} S.\href{../exec/runtime.html#syntax-store}{\mathsf{globals}}[a].\href{../exec/runtime.html#syntax-globalinst}{\mathsf{mut}} = \href{../syntax/types.html#syntax-mut}{\mathsf{var}} \wedge S' = S \href{../syntax/conventions.html#notation-replace}{\mathrel{\mbox{with}}} \href{../exec/runtime.html#syntax-store}{\mathsf{globals}}[a].\href{../exec/runtime.html#syntax-globalinst}{\mathsf{value}} = v) \\
\mathrm{global\_write}(S, a, v) &amp;=&amp; \href{../appendix/embedding.html#embed-error}{\mathsf{error}} &amp;&amp; (\mathrel{\mbox{otherwise}}) \\
\end{array}\end{split}\]</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, WebAssembly Community Group.
      
    </div>

    

    
  </body>
</html>